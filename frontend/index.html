<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>NORTHWEST Hotel - Hệ thống Quản lý Khách sạn</title>
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- QR Code Library (không cần nữa vì dùng VietQR API) -->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script> -->
    <style>
      
      :root {
        --blue: #0f4aa6;
        --deep: #0b3b82;
        --pill: #2f5fb6;
        --muted: #f2f4f7;
        --glass: rgba(255, 255, 255, 0.95);
        --success: #28a745;
        --warning: #ffc107;
        --danger: #dc3545;
        --info: #17a2b8;
        --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        --gradient-blue: linear-gradient(135deg, #0f4aa6 0%, #2f5fb6 100%);
        --shadow-sm: 0 2px 4px rgba(0,0,0,0.1);
        --shadow-md: 0 4px 12px rgba(0,0,0,0.15);
        --shadow-lg: 0 8px 24px rgba(0,0,0,0.2);
      }
      * {
        box-sizing: border-box;
        font-family: "Inter", "Segoe UI", Roboto, Arial, sans-serif;
      }
      body {
        margin: 0;
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        background-attachment: fixed;
        color: #222;
        min-height: 100vh;
        font-weight: 400;
        line-height: 1.6;
        overflow-x: hidden;
      }
      html, body {
        height: 100%;
      }

      .app {
        width: 100%;
        margin: 0;
        padding: 0;
        height: 100vh;
      }

      /* Main layout */
      .layout {
        display: grid;
        grid-template-columns: 280px 1fr;
        gap: 0;
        height: 100%;
        overflow: hidden;
      }

      /* Left column (hero + nav) */
      .left-card {
        background: rgba(255, 255, 255, 0.95);
        -webkit-backdrop-filter: blur(10px);
        backdrop-filter: blur(10px);
        box-shadow: 2px 0 8px rgba(0,0,0,0.1);
        border-right: 1px solid rgba(0,0,0,0.1);
        height: 100%;
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }
      .left-card .nav {
        flex: 1;
        overflow-y: auto;
        min-height: 0;
        padding-top: 20px;
      }
      .sidebar-header {
        padding: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #0f4aa6 100%);
        color: #fff;
        text-align: center;
        flex-shrink: 0;
      }
      .sidebar-header h2 {
        margin: 0;
        font-size: 20px;
        font-weight: 700;
      }
      .sidebar-header .user-info {
        margin-top: 10px;
        font-size: 12px;
        opacity: 0.9;
      }
      .sidebar-header .logout-btn {
        margin-top: 12px;
        padding: 6px 16px;
        background: rgba(255,255,255,0.2);
        border: 1px solid rgba(255,255,255,0.3);
        border-radius: 6px;
        color: #fff;
        cursor: pointer;
        font-size: 12px;
        transition: all 0.3s;
      }
      .sidebar-header .logout-btn:hover {
        background: rgba(255,255,255,0.3);
      }
      
      /* Login Page */
      .login-page {
        width: 100%;
        height: 100vh;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #0f4aa6 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        overflow: hidden;
      }
      .login-page::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url('data:image/svg+xml,<svg width="100" height="100" xmlns="http://www.w3.org/2000/svg"><defs><pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse"><path d="M 40 0 L 0 0 0 40" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="1"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
        opacity: 0.3;
      }
      .login-container {
        position: relative;
        z-index: 1;
        width: 100%;
        max-width: 420px;
        padding: 20px;
      }
      .login-card {
        background: rgba(255, 255, 255, 0.95);
        -webkit-backdrop-filter: blur(10px);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 40px;
        box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      }
      .login-header {
        text-align: center;
        margin-bottom: 32px;
      }
      .login-logo {
        width: 80px;
        height: 80px;
        margin: 0 auto 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 36px;
        color: #fff;
        box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
      }
      .login-header h1 {
        margin: 0 0 8px 0;
        font-size: 28px;
        font-weight: 700;
        color: var(--deep);
      }
      .login-header p {
        margin: 0;
        font-size: 14px;
        color: #666;
      }
      .login-form .form-group {
        margin-bottom: 20px;
      }
      .login-form .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: var(--deep);
        font-size: 14px;
      }
      .login-form .form-group label i {
        margin-right: 8px;
        color: var(--blue);
      }
      .login-form .form-group input {
        width: 100%;
        padding: 14px 16px;
        border: 2px solid #e0e0e0;
        border-radius: 10px;
        font-size: 15px;
        transition: all 0.3s;
      }
      .login-form .form-group input:focus {
        outline: none;
        border-color: var(--blue);
        box-shadow: 0 0 0 3px rgba(15, 74, 166, 0.1);
      }
      .btn-login {
        width: 100%;
        padding: 14px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: #fff;
        border: none;
        border-radius: 10px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        margin-top: 8px;
      }
      .btn-login:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
      }
      .btn-login:active {
        transform: translateY(0);
      }
      .btn-login i {
        margin-right: 8px;
      }
      .login-error {
        margin-top: 16px;
        padding: 12px;
        background: #fee;
        border: 1px solid #fcc;
        border-radius: 8px;
        color: #c33;
        font-size: 14px;
        text-align: center;
      }

      .nav {
        display: flex;
        flex-direction: column;
        gap: 8px;
        padding: 16px;
        background: linear-gradient(180deg, #123e8a, #0f4aa6);
        flex: 1;
        overflow-y: auto;
      }
      .nav button {
        background: transparent;
        border: none;
        color: #fff;
        padding: 14px 16px;
        border-radius: 12px;
        text-align: left;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
        display: flex;
        align-items: center;
        gap: 12px;
        font-size: 14px;
      }
      .nav button i {
        width: 20px;
        text-align: center;
        font-size: 16px;
      }
      .nav button::before {
        content: '';
        position: absolute;
        left: 0;
        top: 0;
        height: 100%;
        width: 4px;
        background: #fff;
        transform: scaleY(0);
        transition: transform 0.3s ease;
      }
      .nav button:hover {
        background: rgba(255, 255, 255, 0.15);
      }
      .nav button.active {
        background: rgba(255, 255, 255, 0.2);
        box-shadow: inset 0 2px 8px rgba(0,0,0,0.1);
      }
      .nav button.active::before {
        transform: scaleY(1);
      }

      /* Right column */
      .panel {
        background: rgba(255, 255, 255, 0.95);
        -webkit-backdrop-filter: blur(10px);
        backdrop-filter: blur(10px);
        overflow: hidden;
        display: flex;
        flex-direction: column;
        height: 100%;
      }
      .panel .head {
        background: var(--gradient-blue);
        color: #fff;
        padding: 20px 28px;
        font-weight: 700;
        font-size: 20px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        letter-spacing: 0.5px;
      }
      .panel .content {
        padding: 24px;
        overflow-y: auto;
        flex: 1;
        background: #f8f9fa;
      }

      /* Page visibility */
      .page {
        display: none;
        opacity: 0;
        transition: opacity 0.3s ease-in-out;
      }
      .page.active {
        display: block !important;
        opacity: 1 !important;
        visibility: visible !important;
      }
      /* Override ANY display: none for active pages - CRITICAL - Highest specificity */
      .page.active[style*="display: none"],
      .page.active[style*="display:none"],
      .page.active[style*="display: none !important"],
      .page.active[style*="display:none !important"] {
        display: block !important;
        opacity: 1 !important;
        visibility: visible !important;
      }
      /* Ensure page is visible when display is set inline */
      .page[style*="display: block"] {
        display: block !important;
        opacity: 1 !important;
      }
      /* Force visibility for active pages - Highest priority */
      .page.active[style*="display: block"],
      .page.active[style*="display:block"],
      .page.active[style*="display: block !important"],
      .page.active[style*="display:block !important"] {
        display: block !important;
        opacity: 1 !important;
        visibility: visible !important;
      }
      .page.loading {
        /* KHÔNG set opacity: 0.5 nữa - để page luôn hiển thị rõ */
        /* opacity: 0.5; */
      }
      /* Đảm bảo active pages luôn có opacity: 1 ngay cả khi có class loading */
      .page.active.loading {
        opacity: 1 !important;
        display: block !important;
        visibility: visible !important;
      }
      /* CRITICAL: Force display block for active pages regardless of inline styles */
      div.page.active {
        display: block !important;
        opacity: 1 !important;
        visibility: visible !important;
      }
      
      /* Loading overlay */
      .loading-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(255, 255, 255, 0.9);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 100;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s ease;
      }
      .loading-overlay.active {
        opacity: 1;
        pointer-events: all;
      }
      .loading-spinner {
        width: 50px;
        height: 50px;
        border: 4px solid #f3f3f3;
        border-top: 4px solid var(--blue);
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
      
      /* Content container with relative position for loading overlay */
      .panel .content {
        position: relative;
      }

      /* table style */
      table {
        width: 100%;
        border-collapse: collapse;
        background: #fff;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: var(--shadow-sm);
        margin-top: 8px;
      }
      thead th {
        background: var(--gradient-blue);
        color: #fff;
        padding: 16px 14px;
        font-weight: 600;
        text-align: left;
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 1px;
        white-space: nowrap;
      }
      tbody td {
        background: #fff;
        padding: 16px 14px;
        border-bottom: 1px solid #f0f0f0;
        font-size: 14px;
        transition: all 0.2s ease;
        vertical-align: middle;
      }
      tbody tr {
        transition: all 0.2s ease;
        opacity: 0;
        animation: fadeInRow 0.3s ease forwards;
      }
      tbody tr:nth-child(1) { animation-delay: 0.05s; }
      tbody tr:nth-child(2) { animation-delay: 0.1s; }
      tbody tr:nth-child(3) { animation-delay: 0.15s; }
      tbody tr:nth-child(4) { animation-delay: 0.2s; }
      tbody tr:nth-child(5) { animation-delay: 0.25s; }
      tbody tr:nth-child(n+6) { animation-delay: 0.3s; }
      @keyframes fadeInRow {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      tbody tr:hover {
        background: #f8f9fa;
      }
      tbody tr:last-child td {
        border-bottom: none;
      }
      td.actions {
        white-space: nowrap;
      }
      .btn {
        display: inline-block;
        padding: 10px 20px;
        border-radius: 10px;
        border: none;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s ease;
        box-shadow: var(--shadow-sm);
      }
      .btn:hover {
        box-shadow: var(--shadow-md);
        opacity: 0.9;
      }
      .btn:active {
        opacity: 0.8;
      }
      .btn.small {
        padding: 6px 12px;
        font-size: 13px;
      }
      .btn.primary {
        background: var(--gradient-blue);
        color: #fff;
      }
      .btn.success {
        background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        color: #fff;
      }
      .btn.danger {
        background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        color: #fff;
      }
      .btn.warning {
        background: linear-gradient(135deg, #ffc107 0%, #ff9800 100%);
        color: #fff;
      }
      .btn.ghost {
        background: transparent;
        border: 2px solid var(--blue);
        color: var(--deep);
        display: inline-flex;
        align-items: center;
        gap: 6px;
      }
      .btn.ghost:hover {
        background: var(--blue);
        color: #fff;
      }
      .btn i {
        font-size: 14px;
      }

      /* controls row */
      .controls {
        display: flex;
        gap: 16px;
        align-items: center;
        margin-bottom: 20px;
        flex-wrap: wrap;
        background: #fff;
        padding: 16px;
        border-radius: 12px;
        box-shadow: var(--shadow-sm);
      }
      .search-bar {
        display: flex;
        gap: 8px;
        align-items: center;
      }
      .search-bar {
        position: relative;
      }
      .search-bar::before {
        content: '\f002';
        font-family: 'Font Awesome 6 Free';
        font-weight: 900;
        position: absolute;
        left: 14px;
        top: 50%;
        transform: translateY(-50%);
        color: #999;
        z-index: 1;
      }
      .search-bar input {
        padding: 10px 16px 10px 40px;
        border-radius: 10px;
        border: 2px solid #e0e0e0;
        width: 320px;
        transition: all 0.3s ease;
        font-size: 14px;
      }
      .search-bar input:focus {
        outline: none;
        border-color: var(--blue);
        box-shadow: 0 0 0 3px rgba(15, 74, 166, 0.1);
      }
      .filter-buttons {
        display: flex;
        gap: 8px;
        margin-left: auto;
      }
      .filter-buttons button {
        padding: 8px 16px;
        border-radius: 20px;
        border: 2px solid transparent;
        background: #eef4ff;
        color: var(--deep);
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s ease;
      }
      .filter-buttons button:hover {
        background: var(--blue);
        color: #fff;
        box-shadow: var(--shadow-sm);
      }
      .filter-buttons button.active {
        background: var(--blue);
        color: #fff;
        border-color: var(--deep);
      }

      /* Dashboard */
      .dashboard {
        padding: 20px 24px;
        height: 100%;
        overflow-y: auto;
      }
      .dashboard .stats-grid {
        margin-bottom: 24px;
      }
      .dashboard .dashboard-actions {
        margin-bottom: 24px;
      }
      .dashboard .recent-section {
        margin-top: 0;
      }
      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
        gap: 24px;
        margin-bottom: 32px;
      }
      .stat-card {
        background: rgba(255, 255, 255, 0.95);
        -webkit-backdrop-filter: blur(10px);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 28px;
        display: flex;
        align-items: center;
        gap: 24px;
        box-shadow: var(--shadow-md);
        border: 1px solid rgba(255, 255, 255, 0.5);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
        opacity: 0;
        animation: fadeInCard 0.4s ease forwards;
      }
      .stat-card:nth-child(1) { animation-delay: 0.1s; }
      .stat-card:nth-child(2) { animation-delay: 0.2s; }
      .stat-card:nth-child(3) { animation-delay: 0.3s; }
      .stat-card:nth-child(4) { animation-delay: 0.4s; }
      @keyframes fadeInCard {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .stat-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 4px;
        height: 100%;
        background: var(--gradient-blue);
        transform: scaleY(0);
        transition: transform 0.3s ease;
      }
      .stat-card:hover::before {
        transform: scaleY(1);
      }
      .stat-card:hover {
        box-shadow: var(--shadow-lg);
      }
      .stat-icon {
        width: 80px;
        height: 80px;
        border-radius: 18px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 28px;
        box-shadow: var(--shadow-md);
        color: #fff;
        flex-shrink: 0;
        position: relative;
      }
      .stat-icon i {
        font-size: 36px;
        z-index: 1;
      }
      .stat-icon::after {
        content: '';
        position: absolute;
        inset: 0;
        border-radius: 18px;
        background: rgba(255, 255, 255, 0.2);
        opacity: 0;
        transition: opacity 0.3s ease;
      }
      .stat-card:hover .stat-icon::after {
        opacity: 1;
      }
      .stat-icon.gradient-1 {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }
      .stat-icon.gradient-2 {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      }
      .stat-icon.gradient-3 {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      }
      .stat-icon.gradient-4 {
        background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
      }
      .stat-content {
        flex: 1;
      }
      .stat-value {
        font-size: 28px;
        font-weight: 800;
        color: var(--deep);
        margin-bottom: 6px;
        line-height: 1.2;
        word-break: break-word;
        overflow-wrap: break-word;
        -webkit-hyphens: auto;
        hyphens: auto;
        max-width: 100%;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      /* Responsive font size for very long numbers */
      .stat-value[style*="font-size"] {
        transition: font-size 0.3s ease;
      }
      .stat-label {
        font-size: 13px;
        color: #666;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }
      .dashboard-actions {
        display: flex;
        gap: 16px;
        margin-bottom: 40px;
        flex-wrap: wrap;
      }
      .dashboard-actions .btn {
        flex: 1;
        min-width: 200px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        font-size: 16px;
        padding: 16px 24px;
      }
      .dashboard-actions .btn i {
        font-size: 18px;
      }
      .recent-section h3 {
        font-size: 22px;
        margin-bottom: 20px;
        font-weight: 700;
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .recent-section h3 i {
        font-size: 20px;
        color: var(--blue);
      }
      .quick-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 16px;
      }
      .quick-stat {
        background: rgba(255, 255, 255, 0.9);
        -webkit-backdrop-filter: blur(10px);
        backdrop-filter: blur(10px);
        padding: 24px;
        border-radius: 12px;
        box-shadow: var(--shadow-sm);
        border: 1px solid rgba(255, 255, 255, 0.3);
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: all 0.3s ease;
      }
      .quick-stat:hover {
        box-shadow: var(--shadow-md);
      }
      .quick-label {
        color: #666;
        font-weight: 600;
        font-size: 14px;
      }
      .quick-value {
        font-size: 28px;
        font-weight: 800;
        color: var(--blue);
      }

      /* Modal */
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.6);
        -webkit-backdrop-filter: blur(5px);
        backdrop-filter: blur(5px);
        z-index: 1000;
        align-items: center;
        justify-content: center;
      }
      .modal.active {
        display: flex;
      }
      .modal-content {
        background: #fff;
        border-radius: 20px;
        padding: 32px;
        max-width: 600px;
        width: 90%;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: var(--shadow-lg);
      }
      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
        padding-bottom: 16px;
        border-bottom: 2px solid #f0f0f0;
      }
      .modal-header h2 {
        margin: 0;
        color: var(--deep);
        font-size: 24px;
        display: flex;
        align-items: center;
        gap: 12px;
      }
      .modal-header h2 i {
        color: var(--blue);
      }
      .modal-close {
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        color: #999;
        transition: all 0.3s ease;
        width: 36px;
        height: 36px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 8px;
      }
      .modal-close:hover {
        color: var(--danger);
        background: rgba(220, 53, 69, 0.1);
      }
      .form-group {
        margin-bottom: 20px;
      }
      .form-group label {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 10px;
        color: var(--deep);
        font-weight: 600;
        font-size: 14px;
      }
      .form-group label i {
        color: var(--blue);
        font-size: 14px;
      }
      .form-group input,
      .form-group select,
      .form-group textarea {
        width: 100%;
        padding: 12px 16px;
        border: 2px solid #e0e0e0;
        border-radius: 10px;
        font-size: 14px;
        transition: all 0.3s ease;
        font-family: inherit;
      }
      .form-group textarea {
        resize: vertical;
        min-height: 80px;
      }
      .form-group input:focus,
      .form-group select:focus {
        outline: none;
        border-color: var(--blue);
        box-shadow: 0 0 0 3px rgba(15, 74, 166, 0.1);
      }
      .form-actions {
        display: flex;
        gap: 12px;
        justify-content: flex-end;
        margin-top: 32px;
        padding-top: 24px;
        border-top: 2px solid #f0f0f0;
      }
      .form-actions .btn {
        min-width: 120px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
      }

      /* Loading animation */
      @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
      }
      .loading {
        animation: pulse 1.5s ease-in-out infinite;
      }

      /* Badge/Status */
      .badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }
      .badge.success {
        background: rgba(40, 167, 69, 0.1);
        color: #28a745;
      }
      .badge.warning {
        background: rgba(255, 193, 7, 0.1);
        color: #ffc107;
      }
      .badge.danger {
        background: rgba(220, 53, 69, 0.1);
        color: #dc3545;
      }
      .badge.info {
        background: rgba(23, 162, 184, 0.1);
        color: #17a2b8;
      }

      /* Empty state */
      .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: #999;
      }
      .empty-state i {
        font-size: 64px;
        margin-bottom: 16px;
        opacity: 0.5;
      }
      .empty-state p {
        font-size: 16px;
        margin: 0;
      }

      /* Mobile Menu Toggle Button */
      .mobile-menu-toggle {
        display: none;
        position: fixed;
        top: 15px;
        left: 15px;
        z-index: 1001;
        background: var(--blue);
        color: #fff;
        border: none;
        border-radius: 8px;
        width: 45px;
        height: 45px;
        font-size: 20px;
        cursor: pointer;
        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        align-items: center;
        justify-content: center;
      }
      .mobile-menu-toggle:hover {
        background: var(--deep);
      }
      .sidebar-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0,0,0,0.5);
        z-index: 999;
        opacity: 0;
        transition: opacity 0.3s ease;
      }
      .sidebar-overlay.active {
        opacity: 1;
      }
      .table-wrapper {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        width: 100%;
      }
      table {
        min-width: 800px; /* Ensure table doesn't shrink too much */
      }

      /* responsive */
      @media (max-width: 900px) {
        .mobile-menu-toggle {
          display: flex;
        }
        .layout {
          grid-template-columns: 1fr;
        }
        .left-card {
          position: fixed;
          left: -280px;
          top: 0;
          height: 100vh;
          z-index: 1000;
          transition: left 0.3s ease;
          box-shadow: 2px 0 20px rgba(0,0,0,0.3);
        }
        .left-card.mobile-open {
          left: 0;
        }
        .sidebar-overlay {
          display: block;
        }
        .panel {
          margin-left: 0;
          padding: 60px 12px 20px 12px;
        }
        .page-title {
          font-size: 24px;
          margin-bottom: 16px;
        }
        .stats-grid {
          grid-template-columns: 1fr;
          gap: 12px;
        }
        .stat-card {
          padding: 16px;
        }
        .stat-label {
          font-size: 12px;
        }
        .stat-value {
          font-size: 24px;
        }
        .dashboard-actions {
          flex-direction: column;
        }
        .dashboard-actions button {
          width: 100%;
        }
        .search-bar {
          width: 100%;
        }
        .search-bar input {
          width: 100%;
          font-size: 14px;
        }
        .controls {
          flex-direction: column;
          align-items: stretch;
          padding: 12px;
        }
        .filter-buttons {
          margin-left: 0;
          flex-wrap: wrap;
          gap: 8px;
        }
        .filter-buttons button {
          font-size: 13px;
          padding: 8px 12px;
        }
        .table-wrapper {
          margin: 0 -12px;
          padding: 0 12px;
        }
        table {
          font-size: 13px;
        }
        table th,
        table td {
          padding: 10px 8px;
          white-space: nowrap;
        }
        .btn {
          padding: 8px 14px;
          font-size: 13px;
        }
        .btn.small {
          padding: 5px 10px;
          font-size: 12px;
        }
        .modal-content {
          width: 95%;
          max-width: 95%;
          margin: 20px auto;
          padding: 20px;
        }
        .modal-header h2 {
          font-size: 20px;
        }
        .form-group {
          margin-bottom: 16px;
        }
        .form-group label {
          font-size: 13px;
        }
        .form-group input,
        .form-group select,
        .form-group textarea {
          font-size: 14px;
          padding: 10px 12px;
        }
        .sidebar-header h2 {
          font-size: 18px;
        }
        .sidebar-header .user-info {
          font-size: 11px;
        }
        .nav button {
          padding: 12px 14px;
          font-size: 13px;
        }
      }
      
      @media (max-width: 480px) {
        .panel {
          padding: 60px 8px 16px 8px;
        }
        .page-title {
          font-size: 20px;
        }
        .stat-value {
          font-size: 20px;
        }
        table {
          font-size: 12px;
          min-width: 700px;
        }
        table th,
        table td {
          padding: 8px 6px;
        }
        .modal-content {
          padding: 16px;
        }
        .modal-header h2 {
          font-size: 18px;
        }
        .btn {
          padding: 7px 12px;
          font-size: 12px;
        }
        .controls {
          padding: 10px;
        }
      }

      /* Additional styles for dynamic content */
      .login-error[style*="display: none"] {
        display: none !important;
      }
      .app[style*="display: none"] {
        display: none !important;
      }
      #nav-users[style*="display: none"] {
        display: none !important;
      }
      .modal-content[style*="max-width"] {
        /* max-width được set inline cho responsive - giữ lại */
      }
      #bookingList[style*="max-height"] {
        /* max-height được set inline - giữ lại */
      }
      .recent-section-title {
        margin-top: 30px;
        color: var(--deep);
      }
      .required-asterisk {
        color: #dc3545;
      }
      .form-hint {
        color: #666;
        font-size: 12px;
      }

      /* Dynamic styles - có thể được JavaScript override */
      .login-error.hidden {
        display: none;
      }
      .app.hidden {
        display: none;
      }
      #nav-users.hidden {
        display: none;
      }
      .modal-content.medium {
        max-width: 600px;
      }
      .modal-content.large {
        max-width: 700px;
      }
      #bookingList.scrollable {
        max-height: 400px;
        overflow-y: auto;
      }
    
    </style>
  </head>
  <body>
    <!-- Login Page -->
    <div id="loginPage" class="login-page">
      <div class="login-container">
        <div class="login-card">
          <div class="login-header">
            <div class="login-logo">
              <i class="fas fa-hotel"></i>
            </div>
            <h1>NORTHWEST HOTEL</h1>
            <p>Hệ thống Quản lý Khách sạn</p>
          </div>
          <form id="loginForm" class="login-form">
            <div class="form-group">
              <label><i class="fas fa-user"></i> Tên đăng nhập</label>
              <input type="text" id="loginUsername" required placeholder="Nhập tên đăng nhập" autocomplete="username">
            </div>
            <div class="form-group">
              <label><i class="fas fa-lock"></i> Mật khẩu</label>
              <input type="password" id="loginPassword" required placeholder="Nhập mật khẩu" autocomplete="current-password">
            </div>
            <button type="submit" class="btn-login">
              <i class="fas fa-sign-in-alt"></i> Đăng nhập
            </button>
            <div id="loginError" class="login-error" style="display: none;"></div>
          </form>
        </div>
      </div>
    </div>

    <!-- Main App (hidden until login) -->
    <div class="app" id="mainApp" style="display: none;">
      <!-- Mobile Menu Toggle -->
      <button class="mobile-menu-toggle" id="mobileMenuToggle" onclick="toggleMobileMenu()">
        <i class="fas fa-bars"></i>
      </button>
      <!-- Sidebar Overlay for Mobile -->
      <div class="sidebar-overlay" id="sidebarOverlay" onclick="closeMobileMenu()"></div>
      <div class="layout">
        <!-- LEFT: nav + hero -->
        <aside class="left-card" id="sidebar">
          <div class="sidebar-header">
            <h2><i class="fas fa-hotel"></i> NORTHWEST HOTEL</h2>
            <div class="user-info" id="userInfo">Đang tải...</div>
            <button class="logout-btn" onclick="handleLogout()">
              <i class="fas fa-sign-out-alt"></i> Đăng xuất
            </button>
          </div>
          <nav class="nav" aria-label="Main navigation">
            <button data-page="home" class="active">
              <i class="fas fa-home"></i> Trang chủ
            </button>
            <button data-page="customers">
              <i class="fas fa-users"></i> Khách hàng
            </button>
            <button data-page="rooms">
              <i class="fas fa-bed"></i> Phòng
            </button>
            <button data-page="services">
              <i class="fas fa-concierge-bell"></i> Dịch vụ
            </button>
            <button data-page="bookings">
              <i class="fas fa-calendar-alt"></i> Đặt phòng
            </button>
            <button data-page="invoices">
              <i class="fas fa-file-invoice-dollar"></i> Hóa đơn
            </button>
            <button data-page="usage">
              <i class="fas fa-spa"></i> Sử dụng DV
            </button>
            <button data-page="users" id="nav-users" style="display: none;">
              <i class="fas fa-user-shield"></i> Quản lý nhân viên
            </button>
          </nav>
        </aside>

        <!-- RIGHT: pages container -->
        <section class="panel">
          <div class="head" id="panelTitle">Trang chủ</div>
          <div class="content">
            <!-- PAGES: only one visible at a time -->
            <div id="pages">
              <!-- HOME / DASHBOARD -->
              <div class="page active" id="page-home">
                <div class="dashboard">
                  <div class="stats-grid">
                    <div class="stat-card">
                      <div class="stat-icon" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                        <i class="fas fa-hotel"></i>
                      </div>
                      <div class="stat-content">
                        <div class="stat-value" id="stat-rooms">0</div>
                        <div class="stat-label">Tổng phòng</div>
                      </div>
                    </div>
                    <div class="stat-card">
                      <div class="stat-icon" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                        <i class="fas fa-users"></i>
                      </div>
                      <div class="stat-content">
                        <div class="stat-value" id="stat-customers">0</div>
                        <div class="stat-label">Khách hàng</div>
                      </div>
                    </div>
                    <div class="stat-card">
                      <div class="stat-icon" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                        <i class="fas fa-calendar-check"></i>
                      </div>
                      <div class="stat-content">
                        <div class="stat-value" id="stat-bookings">0</div>
                        <div class="stat-label">Đặt phòng</div>
                      </div>
                    </div>
                    <div class="stat-card">
                      <div class="stat-icon" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                        <i class="fas fa-dollar-sign"></i>
                      </div>
                      <div class="stat-content">
                        <div class="stat-value" id="stat-revenue">0 đ</div>
                        <div class="stat-label">Doanh thu</div>
                      </div>
                    </div>
                  </div>
                  
                  <div class="dashboard-actions">
                    <button class="btn primary" onclick="openBookingModal()">
                      <i class="fas fa-star"></i>
                      <span>Đặt phòng online</span>
                    </button>
                    <button class="btn success" onclick="showCheckInOut()">
                      <i class="fas fa-door-open"></i>
                      <span>Check-in/Check-out</span>
                    </button>
                  </div>

                  <div class="recent-section">
                    <h3 style="margin-top: 30px; color: var(--deep);">
                      <i class="fas fa-chart-bar"></i>
                      <span>Thống kê nhanh</span>
                    </h3>
                    <div class="quick-stats">
                      <div class="quick-stat">
                        <span class="quick-label">Phòng trống:</span>
                        <span class="quick-value" id="stat-empty-rooms">0</span>
                      </div>
                      <div class="quick-stat">
                        <span class="quick-label">Phòng đã đặt:</span>
                        <span class="quick-value" id="stat-booked-rooms">0</span>
                      </div>
                      <div class="quick-stat">
                        <span class="quick-label">Đang sử dụng:</span>
                        <span class="quick-value" id="stat-using-rooms">0</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- CUSTOMERS -->
              <div class="page" id="page-customers">
                <div class="controls">
                  <div class="search-bar">
                    <input
                      placeholder="Tìm theo tên, email, sđt..."
                      id="search-customers"
                    />
                    <button class="btn ghost" onclick="addRow('customers')">
                      <i class="fas fa-plus"></i> Thêm
                    </button>
                  </div>
                  <div class="filter-buttons" id="filters-customers">
                    <button onclick="filterTable('customers','all', this)" class="active">
                      Tất cả
                    </button>
                    <button onclick="filterTable('customers','hasPhone', this)">
                      Có SĐT
                    </button>
                    <button onclick="filterTable('customers','noPhone', this)">
                      Không SĐT
                    </button>
                  </div>
                </div>

                <div class="table-wrapper">
                <table id="table-customers">
                  <thead>
                    <tr>
                      <th>Mã khách hàng</th>
                      <th>Tên khách hàng</th>
                      <th>Email</th>
                      <th>Số điện thoại</th>
                      <th>Địa chỉ</th>
                      <th>Thao tác</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td class="id">KH001</td>
                      <td contenteditable>Nguyen Van A</td>
                      <td contenteditable>nva@example.com</td>
                      <td contenteditable>0911111111</td>
                      <td contenteditable>Hà Nội</td>
                      <td class="actions">
                        <button
                          class="btn small danger"
                          onclick="deleteRow(this)"
                        >
                          <i class="fas fa-trash"></i> Xóa
                        </button>
                      </td>
                    </tr>
                    <tr>
                      <td class="id">KH002</td>
                      <td contenteditable>Tran Thi B</td>
                      <td contenteditable>ttb@example.com</td>
                      <td contenteditable></td>
                      <td contenteditable>HCM</td>
                      <td class="actions">
                        <button
                          class="btn small danger"
                          onclick="deleteRow(this)"
                        >
                          <i class="fas fa-trash"></i> Xóa
                        </button>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>

              <!-- ROOMS -->
              <div class="page" id="page-rooms">
                <div class="controls">
                  <div class="search-bar">
                    <input
                      placeholder="Tìm mã phòng, loại..."
                      id="search-rooms"
                    />
                    <button class="btn ghost" onclick="addRow('rooms')">
                      <i class="fas fa-plus"></i> Thêm
                    </button>
                  </div>
                  <div class="filter-buttons">
                    <button onclick="filterTable('rooms','all', this)" class="active">Tất cả</button>
                    <button onclick="filterTable('rooms','empty', this)">
                      Trống
                    </button>
                    <button onclick="filterTable('rooms','booked', this)">
                      Đã đặt
                    </button>
                  </div>
                </div>
                <div class="table-wrapper">
                <table id="table-rooms">
                  <thead>
                    <tr>
                      <th>Mã phòng</th>
                      <th>Loại phòng</th>
                      <th>Sức chứa</th>
                      <th>Trạng thái</th>
                      <th>Giá</th>
                      <th>Thao tác</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td class="id">P101</td>
                      <td contenteditable>Phòng đơn</td>
                      <td contenteditable>1</td>
                      <td contenteditable>Trống</td>
                      <td contenteditable>500000</td>
                      <td class="actions">
                        <button
                          class="btn small danger"
                          onclick="deleteRow(this)"
                        >
                          <i class="fas fa-trash"></i> Xóa
                        </button>
                      </td>
                    </tr>
                    <tr>
                      <td class="id">P102</td>
                      <td contenteditable>Phòng đôi</td>
                      <td contenteditable>2</td>
                      <td contenteditable>Đã đặt</td>
                      <td contenteditable>800000</td>
                      <td class="actions">
                        <button
                          class="btn small danger"
                          onclick="deleteRow(this)"
                        >
                          <i class="fas fa-trash"></i> Xóa
                        </button>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>

              <!-- SERVICES -->
              <div class="page" id="page-services">
                <div class="controls">
                  <div class="search-bar">
                    <input placeholder="Tìm dịch vụ..." id="search-services" />
                    <button class="btn ghost" onclick="addRow('services')">
                      <i class="fas fa-plus"></i> Thêm
                    </button>
                  </div>
                  <div class="filter-buttons">
                    <button onclick="filterTable('services','all', this)" class="active">
                      Tất cả
                    </button>
                    <button onclick="filterTable('services','cheap', this)">
                      Giá < 500k
                    </button>
                    <button onclick="filterTable('services','exp', this)">
                      Giá >= 500k
                    </button>
                  </div>
                </div>
                <div class="table-wrapper">
                <table id="table-services">
                  <thead>
                    <tr>
                      <th>Mã DV</th>
                      <th>Tên dịch vụ</th>
                      <th>Đơn giá</th>
                      <th>Thao tác</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td class="id">DV01</td>
                      <td contenteditable>Spa</td>
                      <td contenteditable>300000</td>
                      <td class="actions">
                        <button
                          class="btn small danger"
                          onclick="deleteRow(this)"
                        >
                          <i class="fas fa-trash"></i> Xóa
                        </button>
                      </td>
                    </tr>
                    <tr>
                      <td class="id">DV02</td>
                      <td contenteditable>Gym</td>
                      <td contenteditable>0</td>
                      <td class="actions">
                        <button
                          class="btn small danger"
                          onclick="deleteRow(this)"
                        >
                          <i class="fas fa-trash"></i> Xóa
                        </button>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>

              <!-- BOOKINGS -->
              <div class="page" id="page-bookings">
                <div class="controls">
                  <div class="search-bar">
                    <input
                      placeholder="Tìm mã đặt, mã KH..."
                      id="search-bookings"
                    />
                    <button class="btn ghost" onclick="addRow('bookings')">
                      <i class="fas fa-plus"></i> Thêm
                    </button>
                  </div>
                  <div class="filter-buttons">
                    <button onclick="filterTable('bookings','all', this)" class="active">
                      Tất cả
                    </button>
                    <button onclick="filterTable('bookings','active', this)">
                      Hoạt động
                    </button>
                  </div>
                </div>
                <div class="table-wrapper">
                <table id="table-bookings">
                  <thead>
                    <tr>
                      <th>Mã đặt</th>
                      <th>Mã KH</th>
                      <th>Tên khách hàng</th>
                      <th>Phòng</th>
                      <th>Ngày nhận</th>
                      <th>Ngày trả</th>
                      <th>Trạng thái</th>
                      <th>Thao tác</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td class="id">B001</td>
                      <td contenteditable>KH001</td>
                      <td contenteditable>P101</td>
                      <td contenteditable>2025-11-01</td>
                      <td contenteditable>2025-11-02</td>
                      <td contenteditable>Đã đặt</td>
                      <td class="actions">
                        <button
                          class="btn small danger"
                          onclick="deleteRow(this)"
                        >
                          <i class="fas fa-trash"></i> Xóa
                        </button>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>

              <!-- INVOICES -->
              <div class="page" id="page-invoices">
                <div class="controls">
                  <div class="search-bar">
                    <input
                      placeholder="Tìm mã hóa đơn..."
                      id="search-invoices"
                    />
                    <button class="btn ghost" onclick="addRow('invoices')">
                      + Thêm
                    </button>
                  </div>
                  <div class="filter-buttons">
                    <button onclick="filterTable('invoices','all', this)" class="active">
                      Tất cả
                    </button>
                  </div>
                </div>
                <div class="table-wrapper">
                <table id="table-invoices">
                  <thead>
                    <tr>
                      <th>Mã HĐ</th>
                      <th>Ngày lập</th>
                      <th>Tổng tiền</th>
                      <th>Phương thức</th>
                      <th>Trạng thái</th>
                      <th>Thao tác</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td class="id">INV001</td>
                      <td contenteditable>2025-11-04</td>
                      <td contenteditable>6500000</td>
                      <td contenteditable>Tiền mặt</td>
                      <td class="actions">
                        <button
                          class="btn small danger"
                          onclick="deleteRow(this)"
                        >
                          <i class="fas fa-trash"></i> Xóa
                        </button>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>

              <!-- USAGE -->
              <div class="page" id="page-usage">
                <div class="controls">
                  <div class="search-bar">
                    <input
                      placeholder="Tìm sử dụng dịch vụ..."
                      id="search-usage"
                    />
                    <button class="btn ghost" onclick="addRow('usage')">
                      + Thêm
                    </button>
                  </div>
                  <div class="filter-buttons">
                    <button onclick="filterTable('usage','all', this)" class="active">Tất cả</button>
                  </div>
                </div>
                <div class="table-wrapper">
                <table id="table-usage">
                  <thead>
                    <tr>
                      <th>Mã sử dụng</th>
                      <th>Mã đặt</th>
                      <th>Mã dịch vụ</th>
                      <th>Số lượng</th>
                      <th>Thành tiền</th>
                      <th>Thao tác</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td class="id">U001</td>
                      <td contenteditable>B001</td>
                      <td contenteditable>DV01</td>
                      <td contenteditable>1</td>
                      <td contenteditable>300000</td>
                      <td class="actions">
                        <button
                          class="btn small danger"
                          onclick="deleteRow(this)"
                        >
                          <i class="fas fa-trash"></i> Xóa
                        </button>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>

              <!-- USERS MANAGEMENT (Admin only) -->
              <div class="page" id="page-users">
                <div class="controls">
                  <div class="search-bar">
                    <input
                      placeholder="Tìm theo tên, username, email..."
                      id="search-users"
                    />
                    <button class="btn ghost" onclick="addRow('users')">
                      <i class="fas fa-plus"></i> Thêm nhân viên
                    </button>
                  </div>
                  <div class="filter-buttons">
                    <button onclick="filterTable('users','all', this)" class="active">
                      Tất cả
                    </button>
                    <button onclick="filterTable('users','active', this)">
                      Đang hoạt động
                    </button>
                    <button onclick="filterTable('users','inactive', this)">
                      Đã vô hiệu hóa
                    </button>
                  </div>
                </div>
                <div class="table-wrapper">
                <table id="table-users">
                  <thead>
                    <tr>
                      <th>Mã NV</th>
                      <th>Username</th>
                      <th>Họ tên</th>
                      <th>Email</th>
                      <th>Vai trò</th>
                      <th>Trạng thái</th>
                      <th>Thao tác</th>
                    </tr>
                  </thead>
                  <tbody>
                    <!-- Data will be loaded here -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </section>
      </div>
    </div>

    <script>
      // Navigation - sẽ được xử lý bởi app.js
      // Giữ lại để tương thích với code cũ
      const navButtons = document.querySelectorAll(".nav button");
      const pages = document.querySelectorAll(".page");
      const panelTitle = document.getElementById("panelTitle");

      // Function này sẽ được override bởi app.js
      window.showPage = function(page) {
        pages.forEach((p) => p.classList.remove("active"));
        const el = document.getElementById("page-" + page);
        if (el) el.classList.add("active");
        if (panelTitle) {
          panelTitle.textContent =
            document.querySelector('[data-page="' + page + '"]')?.textContent ||
            "NORTHWEST";
        }
      };

      // Remove old event listeners first to prevent duplicates
      navButtons.forEach((btn) => {
        // Clone node to remove all event listeners
        const newBtn = btn.cloneNode(true);
        btn.parentNode.replaceChild(newBtn, btn);
      });
      
      // Get fresh references
      const freshNavButtons = document.querySelectorAll('.nav button[data-page]');
      
      freshNavButtons.forEach((btn) => {
        btn.addEventListener("click", function(e) {
          e.preventDefault();
          e.stopPropagation();
          
          freshNavButtons.forEach((b) => b.classList.remove("active"));
          btn.classList.add("active");
          const page = btn.dataset.page;
          console.log('🖱️ Nav button clicked:', page);
          
          // Luôn dùng window.showPage để đảm bảo dùng function mới nhất
          if (window.showPage) {
            window.showPage(page);
          } else if (typeof showPage === 'function') {
            showPage(page);
          } else {
            console.error('❌ showPage function not found!');
          }
        }, { once: false });
      });

      // Delete row
      function deleteRow(btn) {
        const tr = btn.closest("tr");
        if (!tr) return;
        if (confirm("Bạn có chắc muốn xóa dòng này?")) tr.remove();
      }

      // Add empty row to table
      function addRow(kind) {
        const tb = document
          .getElementById("table-" + kind)
          .querySelector("tbody");
        const id = generateId(kind);
        const cols = tb.parentElement.querySelector("thead th").length;
        const tr = document.createElement("tr");
        // create cells according to thead
        const ths = tb.parentElement.querySelectorAll("thead th");
        ths.forEach((th, i) => {
          const td = document.createElement("td");
          if (i === 0) {
            td.className = "id";
            td.textContent = id;
          } else if (i === ths.length - 1) {
            td.className = "actions";
            td.innerHTML =
              '<button class="btn small danger" onclick="deleteRow(this)">Xóa</button>';
          } else {
            td.contentEditable = true;
            td.textContent = "";
          }
          tr.appendChild(td);
        });
        tb.appendChild(tr);
        // focus first editable cell
        const firstEditable = tr.querySelector("td[contenteditable]");
        if (firstEditable) firstEditable.focus();
      }

      function generateId(kind) {
        const map = {
          customers: "KH",
          rooms: "P",
          services: "DV",
          bookings: "B",
          invoices: "INV",
          usage: "U",
        };
        const prefix = map[kind] || "ID";
        const tb = document
          .getElementById("table-" + kind)
          .querySelectorAll("tbody tr");
        return prefix + String(tb.length + 1).padStart(3, "0");
      }

      // Simple filtering/searching
      function filterTable(kind, mode, buttonElement) {
        // Update active state of filter buttons
        const pageElement = document.getElementById("page-" + kind);
        if (pageElement) {
          const filterContainer = pageElement.querySelector(".filter-buttons");
          if (filterContainer) {
            filterContainer.querySelectorAll('button').forEach(btn => {
              btn.classList.remove('active');
            });
            if (buttonElement) {
              buttonElement.classList.add('active');
            }
          }
        }
        
        const tb = document
          .getElementById("table-" + kind)
          .querySelector("tbody");
        if (!tb) return;
        const rows = Array.from(tb.querySelectorAll("tr"));
        rows.forEach((r) => (r.style.display = ""));
        if (mode === "all") return;
        if (kind === "customers") {
          if (mode === "hasPhone")
            rows.forEach((r) => {
              const phone = r.children[3].textContent.trim();
              if (!phone) r.style.display = "none";
            });
          if (mode === "noPhone")
            rows.forEach((r) => {
              const phone = r.children[3].textContent.trim();
              if (phone) r.style.display = "none";
            });
        }
        if (kind === "rooms") {
          if (mode === "empty")
            rows.forEach((r) => {
              if (r.children[3].textContent.trim().toLowerCase() !== "trống")
                r.style.display = "none";
            });
          if (mode === "booked")
            rows.forEach((r) => {
              if (r.children[3].textContent.trim().toLowerCase() === "trống")
                r.style.display = "none";
            });
        }
        if (kind === "services") {
          if (mode === "cheap")
            rows.forEach((r) => {
              const priceText = r.children[2].textContent.trim();
              // Parse price from text like "150.000 đ" or "150000 đ"
              const price = parseFloat(priceText.replace(/[^\d]/g, '')) || 0;
              if (price >= 500000)
                r.style.display = "none";
            });
          if (mode === "exp")
            rows.forEach((r) => {
              const priceText = r.children[2].textContent.trim();
              // Parse price from text like "150.000 đ" or "150000 đ"
              const price = parseFloat(priceText.replace(/[^\d]/g, '')) || 0;
              if (price < 500000)
                r.style.display = "none";
            });
        }
        if (kind === "bookings") {
          if (mode === "active")
            rows.forEach((r) => {
              const status = r.children[6].textContent.trim().toLowerCase();
              // Hoạt động = Đã xác nhận hoặc Đã check-in (chưa checkout, chưa hủy)
              if (!status.includes("đã xác nhận") && !status.includes("đã check-in") && !status.includes("chờ xác nhận"))
                r.style.display = "none";
            });
        }
        if (kind === "users") {
          if (mode === "active")
            rows.forEach((r) => {
              if (r.children[5].textContent.trim().toLowerCase().indexOf("đang hoạt động") === -1)
                r.style.display = "none";
            });
          if (mode === "inactive")
            rows.forEach((r) => {
              if (r.children[5].textContent.trim().toLowerCase().indexOf("vô hiệu hóa") === -1)
                r.style.display = "none";
            });
        }
      }

      // Search inputs: live filter by text across row cells
      function wireSearch(idPrefix, colCount) {
        const input = document.getElementById("search-" + idPrefix);
        if (!input) return;
        input.addEventListener("input", () => {
          const tb = document
            .getElementById("table-" + idPrefix)
            .querySelector("tbody");
          const rows = Array.from(tb.querySelectorAll("tr"));
          const q = input.value.toLowerCase();
          rows.forEach((r) => {
            const text = Array.from(r.children)
              .map((td) => td.textContent.toLowerCase())
              .join(" ");
            r.style.display = text.indexOf(q) === -1 ? "none" : "";
          });
        });
      }

      [
        "customers",
        "rooms",
        "services",
        "bookings",
        "invoices",
        "usage",
        "users",
      ].forEach((k) => wireSearch(k));

      // Initial show home - sẽ được xử lý bởi app.js
      // app.js sẽ tự động load trang home

      // Allow pressing Enter in contenteditable to blur (prevent new line)
      document.addEventListener("keydown", (e) => {
        if (
          e.key === "Enter" &&
          document.activeElement &&
          document.activeElement.isContentEditable
        ) {
          e.preventDefault();
          document.activeElement.blur();
        }
      });

      // Save / export (optional) - example: export table data to console
      function exportData() {
        const data = {};
        [
          "customers",
          "rooms",
          "services",
          "bookings",
          "invoices",
          "usage",
        ].forEach((kind) => {
          const rows = [];
          const tb = document
            .getElementById("table-" + kind)
            .querySelector("tbody");
          tb.querySelectorAll("tr").forEach((tr) => {
            const cells = Array.from(tr.children).map((td) =>
              td.textContent.trim()
            );
            rows.push(cells);
          });
          data[kind] = rows;
        });
        console.log("Exported data:", data);
        alert("Dữ liệu được xuất ra console (F12 để xem).");
      }

      // Optional: keyboard shortcut Ctrl+S to export
      document.addEventListener("keydown", (e) => {
        if ((e.ctrlKey || e.metaKey) && e.key === "s") {
          e.preventDefault();
          exportData();
        }
      });
    </script>

    <!-- Modal Đặt phòng -->
    <div id="bookingModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2><i class="fas fa-star"></i> Đặt phòng online</h2>
          <button class="modal-close" onclick="closeBookingModal()"><i class="fas fa-times"></i></button>
        </div>
        <form id="bookingForm" onsubmit="handleBookingSubmit(event); return false;">
          <div class="form-group">
            <label><i class="fas fa-user"></i> Khách hàng *</label>
            <select id="bookingCustomer" required>
              <option value="">-- Chọn khách hàng --</option>
            </select>
          </div>
          <div class="form-group">
            <label><i class="fas fa-bed"></i> Phòng *</label>
            <select id="bookingRoom" required>
              <option value="">-- Chọn phòng --</option>
            </select>
          </div>
          <div class="form-group">
            <label><i class="fas fa-calendar-alt"></i> Ngày nhận *</label>
            <input type="date" id="bookingCheckIn" required>
          </div>
          <div class="form-group">
            <label><i class="fas fa-calendar-check"></i> Ngày trả *</label>
            <input type="date" id="bookingCheckOut" required>
          </div>
          <div class="form-group">
            <label><i class="fas fa-users"></i> Số người *</label>
            <input type="number" id="bookingGuests" min="1" required>
          </div>
          <div class="form-actions">
            <button type="button" class="btn ghost" onclick="closeBookingModal()">
              <i class="fas fa-times"></i> Hủy
            </button>
            <button type="submit" class="btn primary">
              <i class="fas fa-check"></i> Đặt phòng
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Modal Check-in/Check-out -->
    <div id="checkInOutModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2><i class="fas fa-door-open"></i> Check-in / Check-out</h2>
          <button class="modal-close" onclick="closeCheckInOutModal()"><i class="fas fa-times"></i></button>
        </div>
        <div id="checkInOutContent">
          <div class="form-group">
            <label><i class="fas fa-search"></i> Tìm đặt phòng (Mã đặt hoặc Tên KH)</label>
            <input type="text" id="searchBooking" placeholder="Nhập mã đặt hoặc tên khách hàng..." onkeyup="searchBookingForCheckInOut()">
          </div>
          <div id="bookingList" style="max-height: 400px; overflow-y: auto;">
            <!-- Danh sách đặt phòng sẽ được load ở đây -->
          </div>
        </div>
      </div>
    </div>

    <!-- Modal Thêm/Sửa Khách hàng -->
    <div id="customerModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2><i class="fas fa-user-plus"></i> <span id="customerModalTitle">Thêm khách hàng</span></h2>
          <button class="modal-close" onclick="closeCustomerModal()"><i class="fas fa-times"></i></button>
        </div>
        <form id="customerForm" onsubmit="handleCustomerSubmit(event); return false;">
          <div class="form-group">
            <label><i class="fas fa-id-card"></i> Họ tên *</label>
            <input type="text" id="customerHoTen" required placeholder="Nhập họ tên khách hàng">
          </div>
          <div class="form-group">
            <label><i class="fas fa-envelope"></i> Email</label>
            <input type="email" id="customerEmail" placeholder="email@example.com">
          </div>
          <div class="form-group">
            <label><i class="fas fa-phone"></i> Số điện thoại</label>
            <input type="tel" id="customerPhone" placeholder="0912345678">
          </div>
          <div class="form-group">
            <label><i class="fas fa-id-badge"></i> CCCD</label>
            <input type="text" id="customerCCCD" placeholder="001234567890">
          </div>
          <div class="form-group">
            <label><i class="fas fa-map-marker-alt"></i> Địa chỉ</label>
            <input type="text" id="customerAddress" placeholder="Nhập địa chỉ">
          </div>
          <div class="form-actions">
            <button type="button" class="btn ghost" onclick="closeCustomerModal()">
              <i class="fas fa-times"></i> Hủy
            </button>
            <button type="submit" class="btn primary">
              <i class="fas fa-save"></i> Lưu
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Modal Thêm/Sửa Phòng -->
    <div id="roomModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2><i class="fas fa-bed"></i> <span id="roomModalTitle">Thêm phòng</span></h2>
          <button class="modal-close" onclick="closeRoomModal()"><i class="fas fa-times"></i></button>
        </div>
        <form id="roomForm" onsubmit="handleRoomSubmit(event); return false;">
          <div class="form-group">
            <label><i class="fas fa-hashtag"></i> Số phòng *</label>
            <input type="text" id="roomSoPhong" required placeholder="101, 102, 201...">
          </div>
          <div class="form-group">
            <label><i class="fas fa-tag"></i> Loại phòng</label>
            <select id="roomLoai">
              <option value="1">Standard</option>
              <option value="2">Deluxe</option>
              <option value="3">Suite</option>
            </select>
          </div>
          <div class="form-group">
            <label><i class="fas fa-info-circle"></i> Trạng thái</label>
            <select id="roomTinhTrang">
              <option value="trong">Trống</option>
              <option value="da_dat">Đã đặt</option>
              <option value="dang_su_dung">Đang sử dụng</option>
              <option value="bao_tri">Bảo trì</option>
            </select>
          </div>
          <div class="form-actions">
            <button type="button" class="btn ghost" onclick="closeRoomModal()">
              <i class="fas fa-times"></i> Hủy
            </button>
            <button type="submit" class="btn primary">
              <i class="fas fa-save"></i> Lưu
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Modal Thêm/Sửa Dịch vụ -->
    <div id="serviceModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2><i class="fas fa-concierge-bell"></i> <span id="serviceModalTitle">Thêm dịch vụ</span></h2>
          <button class="modal-close" onclick="closeServiceModal()"><i class="fas fa-times"></i></button>
        </div>
        <form id="serviceForm" onsubmit="handleServiceSubmit(event); return false;">
          <div class="form-group">
            <label><i class="fas fa-tag"></i> Tên dịch vụ *</label>
            <input type="text" id="serviceTenDV" required placeholder="Nhập tên dịch vụ">
          </div>
          <div class="form-group">
            <label><i class="fas fa-align-left"></i> Mô tả</label>
            <textarea id="serviceMoTa" rows="3" placeholder="Nhập mô tả dịch vụ"></textarea>
          </div>
          <div class="form-group">
            <label><i class="fas fa-money-bill-wave"></i> Đơn giá *</label>
            <input type="number" id="serviceDonGia" required min="0" placeholder="0">
          </div>
          <div class="form-group">
            <label><i class="fas fa-ruler"></i> Đơn vị tính</label>
            <input type="text" id="serviceDonViTinh" placeholder="người, lần, kg...">
          </div>
          <div class="form-actions">
            <button type="button" class="btn ghost" onclick="closeServiceModal()">
              <i class="fas fa-times"></i> Hủy
            </button>
            <button type="submit" class="btn primary">
              <i class="fas fa-save"></i> Lưu
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Modal Thêm/Sửa Đặt phòng -->
    <div id="bookingModalForm" class="modal">
      <div class="modal-content" style="max-width: 700px;">
        <div class="modal-header">
          <h2><i class="fas fa-calendar-plus"></i> <span id="bookingModalTitle">Thêm đặt phòng</span></h2>
          <button class="modal-close" onclick="closeBookingModalForm()"><i class="fas fa-times"></i></button>
        </div>
        <form id="bookingFormModal" onsubmit="handleBookingFormSubmit(event); return false;">
          <div class="form-group">
            <label><i class="fas fa-user"></i> Khách hàng *</label>
            <select id="bookingMaKH" required>
              <option value="">-- Chọn khách hàng --</option>
            </select>
          </div>
          <div class="form-group">
            <label><i class="fas fa-bed"></i> Phòng *</label>
            <select id="bookingMaPhong" required>
              <option value="">-- Chọn phòng --</option>
            </select>
          </div>
          <div class="form-group">
            <label><i class="fas fa-calendar-check"></i> Ngày nhận *</label>
            <input type="date" id="bookingNgayNhan" required>
          </div>
          <div class="form-group">
            <label><i class="fas fa-calendar-times"></i> Ngày trả *</label>
            <input type="date" id="bookingNgayTra" required>
          </div>
          <div class="form-group">
            <label><i class="fas fa-users"></i> Số người *</label>
            <input type="number" id="bookingSoNguoi" required min="1" placeholder="1">
          </div>
          <div class="form-group">
            <label><i class="fas fa-info-circle"></i> Trạng thái</label>
            <select id="bookingTrangThai">
              <option value="cho_xac_nhan">Chờ xác nhận</option>
              <option value="da_xac_nhan">Đã xác nhận</option>
              <option value="da_checkin">Đã check-in</option>
              <option value="da_checkout">Đã check-out</option>
              <option value="da_huy">Đã hủy</option>
            </select>
          </div>
          <div class="form-actions">
            <button type="button" class="btn ghost" onclick="closeBookingModalForm()">
              <i class="fas fa-times"></i> Hủy
            </button>
            <button type="submit" class="btn primary">
              <i class="fas fa-save"></i> Lưu
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Modal Thêm/Sửa Hóa đơn -->
    <div id="invoiceModal" class="modal">
      <div class="modal-content" style="max-width: 600px;">
        <div class="modal-header">
          <h2><i class="fas fa-file-invoice-dollar"></i> <span id="invoiceModalTitle">Thêm hóa đơn</span></h2>
          <button class="modal-close" onclick="closeInvoiceModal()"><i class="fas fa-times"></i></button>
        </div>
        <form id="invoiceForm" onsubmit="handleInvoiceSubmit(event); return false;">
          <div class="form-group">
            <label><i class="fas fa-calendar-check"></i> Mã đặt phòng *</label>
            <select id="invoiceMaDatPhong" required>
              <option value="">-- Chọn đặt phòng --</option>
            </select>
          </div>
          <div class="form-group">
            <label><i class="fas fa-money-bill-wave"></i> Tổng tiền *</label>
            <input type="number" id="invoiceTongTien" required min="0" placeholder="0">
          </div>
          <div class="form-group">
            <label><i class="fas fa-credit-card"></i> Phương thức thanh toán</label>
            <select id="invoicePhuongThucTT">
              <option value="tien_mat">Tiền mặt</option>
              <option value="chuyen_khoan">Chuyển khoản</option>
              <option value="the">Thẻ</option>
            </select>
          </div>
          <div class="form-group">
            <label><i class="fas fa-info-circle"></i> Trạng thái</label>
            <select id="invoiceTrangThai">
              <option value="chua_thanh_toan">Chưa thanh toán</option>
              <option value="da_thanh_toan">Đã thanh toán</option>
            </select>
          </div>
          <div class="form-actions">
            <button type="button" class="btn ghost" onclick="closeInvoiceModal()">
              <i class="fas fa-times"></i> Hủy
            </button>
            <button type="submit" class="btn primary">
              <i class="fas fa-save"></i> Lưu
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Modal QR Code Thanh toán -->
    <div id="qrPaymentModal" class="modal">
      <div class="modal-content" style="max-width: 500px;">
        <div class="modal-header">
          <h2><i class="fas fa-qrcode"></i> Thanh toán QR Code</h2>
          <button class="modal-close" onclick="closeQRPaymentModal()"><i class="fas fa-times"></i></button>
        </div>
        <div style="text-align: center; padding: 20px;">
          <div id="qrCodeContainer" style="display: flex; justify-content: center; margin-bottom: 20px; min-height: 250px; align-items: center;"></div>
          <div style="background: #f8f9fa; padding: 16px; border-radius: 10px; margin-bottom: 20px;">
            <div style="margin-bottom: 8px;">
              <strong>Số tài khoản:</strong> <span id="qrAccountNumber" style="color: #0f4aa6; font-size: 18px; font-weight: bold;">100878031328</span>
            </div>
            <div style="margin-bottom: 8px;">
              <strong>Ngân hàng:</strong> <span style="color: #0f4aa6; font-weight: bold;">Vietinbank</span>
            </div>
            <div style="margin-bottom: 8px;">
              <strong>Tên tài khoản:</strong> <span style="color: #0f4aa6;">CO HUU DIEM</span>
            </div>
            <div style="margin-bottom: 8px;">
              <strong>Số tiền:</strong> <span id="qrAmount" style="color: #28a745; font-size: 18px; font-weight: bold;"></span>
            </div>
            <div>
              <strong>Nội dung:</strong> <span id="qrContent" style="color: #666;"></span>
            </div>
          </div>
          <div style="background: #fff3cd; border: 1px solid #ffc107; border-radius: 8px; padding: 12px; margin-bottom: 20px; font-size: 13px; color: #856404;">
            <i class="fas fa-info-circle"></i> QR code được tạo bởi <strong>VietQR</strong>. Khách hàng mở app ngân hàng (Vietinbank, MB Bank, Vietcombank, BIDV, Techcombank...) và quét QR code để thanh toán
          </div>
          <div id="autoCheckPayment" style="display: none; background: #d1ecf1; border: 1px solid #17a2b8; border-radius: 8px; padding: 12px; margin-bottom: 20px; font-size: 13px; color: #0c5460;">
            <span id="autoCheckStatus">Đang kiểm tra thanh toán tự động...</span>
          </div>
          <div style="display: flex; gap: 12px; justify-content: center;">
            <button type="button" class="btn ghost" onclick="closeQRPaymentModal()">
              <i class="fas fa-times"></i> Đóng
            </button>
            <button type="button" class="btn success" onclick="confirmQRPayment()">
              <i class="fas fa-check-circle"></i> Đã thanh toán
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal Thêm/Sửa Nhân viên -->
    <div id="userModal" class="modal">
      <div class="modal-content" style="max-width: 600px;">
        <div class="modal-header">
          <h2><i class="fas fa-user-shield"></i> <span id="userModalTitle">Thêm nhân viên</span></h2>
          <button class="modal-close" onclick="closeUserModal()"><i class="fas fa-times"></i></button>
        </div>
        <form id="userForm" onsubmit="handleUserSubmit(event); return false;">
          <div class="form-group">
            <label><i class="fas fa-user"></i> Username *</label>
            <input type="text" id="userUsername" required placeholder="Nhập username">
          </div>
          <div class="form-group">
            <label><i class="fas fa-lock"></i> Mật khẩu <span id="passwordRequired" style="color: #dc3545;">*</span></label>
            <input type="password" id="userPassword" placeholder="Để trống nếu không đổi">
            <small style="color: #666; font-size: 12px;">Khi sửa, để trống nếu không muốn đổi mật khẩu</small>
          </div>
          <div class="form-group">
            <label><i class="fas fa-id-card"></i> Họ tên *</label>
            <input type="text" id="userHoTen" required placeholder="Nhập họ tên">
          </div>
          <div class="form-group">
            <label><i class="fas fa-envelope"></i> Email</label>
            <input type="email" id="userEmail" placeholder="email@example.com">
          </div>
          <div class="form-group">
            <label><i class="fas fa-user-tag"></i> Vai trò *</label>
            <select id="userVaiTro" required>
              <option value="nhan_vien">Nhân viên</option>
              <option value="quan_ly">Quản lý</option>
              <option value="admin">Quản trị viên</option>
            </select>
          </div>
          <div class="form-group">
            <label><i class="fas fa-info-circle"></i> Trạng thái</label>
            <select id="userTrangThai">
              <option value="active">Đang hoạt động</option>
              <option value="inactive">Vô hiệu hóa</option>
            </select>
          </div>
          <div class="form-actions">
            <button type="button" class="btn ghost" onclick="closeUserModal()">
              <i class="fas fa-times"></i> Hủy
            </button>
            <button type="submit" class="btn primary">
              <i class="fas fa-save"></i> Lưu
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Modal Thêm/Sửa Sử dụng dịch vụ -->
    <div id="usageModal" class="modal">
      <div class="modal-content" style="max-width: 600px;">
        <div class="modal-header">
          <h2><i class="fas fa-spa"></i> <span id="usageModalTitle">Thêm sử dụng dịch vụ</span></h2>
          <button class="modal-close" onclick="closeUsageModal()"><i class="fas fa-times"></i></button>
        </div>
        <form id="usageForm" onsubmit="handleUsageSubmit(event); return false;">
          <div class="form-group">
            <label><i class="fas fa-calendar-check"></i> Mã đặt phòng *</label>
            <select id="usageMaDatPhong" required>
              <option value="">-- Chọn đặt phòng --</option>
            </select>
          </div>
          <div class="form-group">
            <label><i class="fas fa-concierge-bell"></i> Dịch vụ *</label>
            <select id="usageMaDV" required>
              <option value="">-- Chọn dịch vụ --</option>
            </select>
          </div>
          <div class="form-group">
            <label><i class="fas fa-sort-numeric-up"></i> Số lượng *</label>
            <input type="number" id="usageSoLuong" required min="1" value="1" placeholder="1">
          </div>
          <div class="form-group">
            <label><i class="fas fa-calendar"></i> Ngày sử dụng</label>
            <input type="date" id="usageNgaySuDung">
          </div>
          <div class="form-actions">
            <button type="button" class="btn ghost" onclick="closeUsageModal()">
              <i class="fas fa-times"></i> Hủy
            </button>
            <button type="submit" class="btn primary">
              <i class="fas fa-save"></i> Lưu
            </button>
          </div>
        </form>
      </div>
    </div>

  <!-- Scripts -->
  <script>
    // API Configuration - khai báo global
    // Tự động detect API URL (production hoặc local)
    // Nếu deploy lên Render, sửa dòng dưới thành Backend URL thực tế
    const isProduction = window.location.hostname !== 'localhost' && window.location.hostname !== '127.0.0.1';
    window.API_BASE = isProduction 
      ? "https://deployquanlihotel.onrender.com/api"  // Backend URL production
      : "http://localhost:3001/api";  // Local development
    const API_BASE = window.API_BASE;
    console.log('API_BASE:', API_BASE, 'isProduction:', isProduction, 'hostname:', window.location.hostname);
    
    // Get auth token
    function getAuthToken() {
      return localStorage.getItem('token');
    }
    
    // Add token to fetch requests
    async function fetchWithAuth(url, options = {}) {
      const token = getAuthToken();
      if (token) {
        options.headers = {
          ...options.headers,
          'Authorization': `Bearer ${token}`
        };
      }
      return fetch(url, options);
    }
    
    // Login functionality
    document.getElementById('loginForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const username = document.getElementById('loginUsername').value;
      const password = document.getElementById('loginPassword').value;
      const errorDiv = document.getElementById('loginError');
      
      errorDiv.style.display = 'none';
      
      try {
        const response = await fetch(`${API_BASE}/auth/login`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username, password })
        });
        
        const result = await response.json();
        
        if (response.ok) {
          localStorage.setItem('token', result.token);
          localStorage.setItem('user', JSON.stringify(result.user));
          document.getElementById('loginPage').style.display = 'none';
          document.getElementById('mainApp').style.display = 'block';
          updateUserInfo(result.user);
        } else {
          errorDiv.textContent = result.error || 'Đăng nhập thất bại';
          errorDiv.style.display = 'block';
        }
      } catch (error) {
        errorDiv.textContent = 'Lỗi kết nối: ' + error.message;
        errorDiv.style.display = 'block';
      }
    });
    
    function updateUserInfo(user) {
      const userInfo = document.getElementById('userInfo');
      if (user) {
        const roleText = {
          'admin': 'Quản trị viên',
          'quan_ly': 'Quản lý',
          'nhan_vien': 'Nhân viên'
        };
        const roleIcon = {
          'admin': 'fa-crown',
          'quan_ly': 'fa-user-shield',
          'nhan_vien': 'fa-user'
        };
        const role = user.VaiTro || 'nhan_vien';
        userInfo.innerHTML = `
          <i class="fas fa-user-circle"></i> ${user.HoTen || user.Username}<br>
          <small style="opacity: 0.8;"><i class="fas ${roleIcon[role]}"></i> ${roleText[role]}</small>
        `;
        
        // Apply permissions based on role
        setTimeout(() => applyUserPermissions(user), 200);
      }
    }
    
    function applyUserPermissions(user) {
      const role = user.VaiTro || 'nhan_vien';
      
      if (role === 'nhan_vien') {
        document.querySelectorAll('.btn.small.primary').forEach(btn => {
          if (btn.textContent.includes('Sửa') || btn.innerHTML.includes('fa-edit')) {
            btn.style.display = 'none';
          }
        });
        
        document.querySelectorAll('.btn.small.danger, .btn.danger').forEach(btn => {
          if (btn.textContent.includes('Xóa') || btn.innerHTML.includes('fa-trash')) {
            btn.style.display = 'none';
          }
        });
        
        document.querySelectorAll('[data-role-restrict]').forEach(btn => {
          const restrictedRole = btn.getAttribute('data-role-restrict');
          if (restrictedRole === role) {
            btn.style.display = 'none';
          }
        });
        
        document.querySelectorAll('[contenteditable="true"]').forEach(el => {
          el.contentEditable = 'false';
          el.style.cursor = 'default';
          el.style.backgroundColor = '#f8f9fa';
        });
      } else if (role === 'quan_ly') {
        document.querySelectorAll('[data-role-restrict="admin"]').forEach(btn => {
          btn.style.display = 'none';
        });
        const navUsers = document.getElementById('nav-users');
        if (navUsers) navUsers.style.display = 'none';
      }
      
      if (role === 'admin') {
        const navUsers = document.getElementById('nav-users');
        if (navUsers) navUsers.style.display = 'block';
      } else {
        const navUsers = document.getElementById('nav-users');
        if (navUsers) navUsers.style.display = 'none';
      }
      
      window.currentUserRole = role;
    }
    
    function handleLogout() {
      if (confirm('Bạn có chắc muốn đăng xuất?')) {
        localStorage.removeItem('token');
        localStorage.removeItem('user');
        document.getElementById('loginPage').style.display = 'flex';
        document.getElementById('mainApp').style.display = 'none';
        document.getElementById('loginForm').reset();
      }
    }
    
    // Check if already logged in
    window.addEventListener('DOMContentLoaded', function() {
      const token = localStorage.getItem('token');
      const user = localStorage.getItem('user');
      
      if (token && user) {
        document.getElementById('loginPage').style.display = 'none';
        document.getElementById('mainApp').style.display = 'block';
        const userData = JSON.parse(user);
        updateUserInfo(userData);
        setTimeout(() => applyUserPermissions(userData), 200);
      } else {
        document.getElementById('loginPage').style.display = 'flex';
        document.getElementById('mainApp').style.display = 'none';
      }
    });
    
    window.handleLogout = handleLogout;
    window.applyUserPermissions = applyUserPermissions;
    
    // Mobile Menu Toggle Functions
    function toggleMobileMenu() {
      const sidebar = document.getElementById('sidebar');
      const overlay = document.getElementById('sidebarOverlay');
      const toggleBtn = document.getElementById('mobileMenuToggle');
      
      if (sidebar && overlay) {
        sidebar.classList.toggle('mobile-open');
        overlay.classList.toggle('active');
        
        // Change icon
        if (toggleBtn) {
          const icon = toggleBtn.querySelector('i');
          if (icon) {
            if (sidebar.classList.contains('mobile-open')) {
              icon.className = 'fas fa-times';
            } else {
              icon.className = 'fas fa-bars';
            }
          }
        }
      }
    }
    
    function closeMobileMenu() {
      const sidebar = document.getElementById('sidebar');
      const overlay = document.getElementById('sidebarOverlay');
      const toggleBtn = document.getElementById('mobileMenuToggle');
      
      if (sidebar && overlay) {
        sidebar.classList.remove('mobile-open');
        overlay.classList.remove('active');
        
        // Change icon back
        if (toggleBtn) {
          const icon = toggleBtn.querySelector('i');
          if (icon) {
            icon.className = 'fas fa-bars';
          }
        }
      }
    }
    
    // Close mobile menu when clicking on nav items
    document.addEventListener('DOMContentLoaded', function() {
      // Use event delegation to avoid duplicate listeners
      const nav = document.querySelector('.nav');
      if (nav) {
        nav.addEventListener('click', function(e) {
          if (e.target.closest('button[data-page]')) {
            // Close mobile menu after a short delay to allow page transition
            setTimeout(closeMobileMenu, 300);
          }
        });
      }
      
      // Close mobile menu on window resize if screen becomes large
      window.addEventListener('resize', function() {
        if (window.innerWidth > 900) {
          closeMobileMenu();
        }
      });
    });
    
    window.toggleMobileMenu = toggleMobileMenu;
    window.closeMobileMenu = closeMobileMenu;
  </script>
  <script src="app.js"></script>
  </body>
</html>
